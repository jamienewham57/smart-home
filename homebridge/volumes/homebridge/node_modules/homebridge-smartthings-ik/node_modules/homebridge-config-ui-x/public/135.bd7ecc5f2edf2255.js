"use strict";(self.webpackChunkui=self.webpackChunkui||[]).push([[135],{92135:(Q,f,s)=>{s.r(f),s.d(f,{DockerModule:()=>V});var u=s(36895),l=s(24006),x=s(8304),c=s(54463),v=s(72501),S=s(40294),p=s(57750),C=s(15861),t=s(94650),_=s(92503),m=s(79274),k=s(58605),y=s(64959),d=s(97185);function T(r,n){1&r&&t._UZ(0,"i",13)}function M(r,n){if(1&r){const e=t.EpF();t.TgZ(0,"ngx-monaco-editor",14),t.NdJ("onInit",function(i){t.CHM(e);const a=t.oxw();return t.KtG(a.onEditorInit(i))})("keydown.control.s",function(i){t.CHM(e);const a=t.oxw();return i.preventDefault(),t.KtG(a.onSave())})("keydown.meta.s",function(i){t.CHM(e);const a=t.oxw();return i.preventDefault(),t.KtG(a.onSave())}),t.qZA()}if(2&r){const e=t.oxw();t.Q6J("options",e.editorOptions)("model",e.monacoEditorModel)}}function $(r,n){if(1&r){const e=t.EpF();t.TgZ(0,"textarea",15),t.NdJ("ngModelChange",function(i){t.CHM(e);const a=t.oxw();return t.KtG(a.startupScript=i)}),t._uU(1,"  "),t.qZA()}if(2&r){const e=t.oxw();t.Q6J("ngModel",e.startupScript)}}let b=(()=>{class r{constructor(e,o,i,a,h,g,R){this.$settings=e,this.$api=o,this.$md=i,this.$monacoEditor=a,this.$toastr=h,this.translate=g,this.$route=R,this.isMobile=!1,this.options={printMargin:!1},this.editorOptions={language:"shell",theme:this.$settings.theme.startsWith("dark-mode")?"vs-dark":"vs-light",automaticLayout:!0},this.isMobile=this.$md.detect.mobile()}ngOnInit(){this.visualViewPortEventCallback=()=>this.visualViewPortChanged(),this.lastHeight=window.innerHeight,window.visualViewport&&!this.isMobile&&(window.visualViewport.addEventListener("resize",this.visualViewPortEventCallback,!0),this.$md.disableTouchMove()),this.$route.data.subscribe(e=>{this.startupScript=e.startupScript.script}),this.monacoEditorModel={value:"",language:"shell"}}onEditorInit(e){this.monacoEditor=e,this.monacoEditor.getModel().setValue(this.startupScript)}onSave(){var e=this;return(0,C.Z)(function*(){if(!e.saveInProgress){if(e.saveInProgress=!0,e.isMobile||(yield e.monacoEditor.getAction("editor.action.formatDocument").run(),e.startupScript=e.monacoEditor.getModel().getValue()),!["#!/bin/sh","#!/bin/bash"].includes(e.startupScript.split("\n")[0].trim()))return e.$toastr.error(e.translate.instant("platform.docker.startup_script.toast_script_must_use_hashbang"),e.translate.instant("platform.docker.startup_script.toast_title_script_error")),e.startupScript="#!/bin/sh\n\n"+e.startupScript,e.isMobile||e.monacoEditor.getModel().setValue(e.startupScript),void(e.saveInProgress=!1);try{yield e.$api.put("/platform-tools/docker/startup-script",{script:e.startupScript}).toPromise(),e.$toastr.success(e.translate.instant("platform.docker.startup_script.toast_restart_required"),e.translate.instant("platform.docker.startup_script.toast_title_script_saved"))}catch(o){e.$toastr.error(o.message,e.translate.instant("toast.title_error"))}e.saveInProgress=!1}})()}visualViewPortChanged(){this.lastHeight<window.visualViewport.height&&document.activeElement.blur(),window.visualViewport.height<window.innerHeight?(this.$md.enableTouchMove(),this.lastHeight=window.visualViewport.height):window.visualViewport.height===window.innerHeight&&(this.$md.disableTouchMove(),this.lastHeight=window.visualViewport.height)}ngOnDestroy(){window.visualViewport&&(window.visualViewport.removeEventListener("resize",this.visualViewPortEventCallback,!0),this.$md.enableTouchMove()),this.monacoEditor&&this.monacoEditor.dispose()}}return r.\u0275fac=function(e){return new(e||r)(t.Y36(_.g),t.Y36(m.s),t.Y36(k.L),t.Y36(y.L),t.Y36(d._W),t.Y36(c.sK),t.Y36(p.gz))},r.\u0275cmp=t.Xpm({type:r,selectors:[["app-startup-script"]],decls:18,vars:8,consts:[[1,"flex-column","d-flex","align-items-stretch","h-100"],[1,"row"],[1,"col-sm-8","d-none","d-sm-block"],[1,"primary-text","m-0"],[1,"d-none","d-md-inline"],[1,"col-sm-4","text-right"],[1,"btn","btn-primary","waves-effect","m-0",3,"disabled","click"],["class","fas fa-spinner fa-pulse",4,"ngIf"],[1,"row","mt-3"],[1,"col-md-12"],["role","alert",1,"alert","alert-warning",3,"translate"],["class","flex-grow-1 h-100 w-100 mb-3 mt-3",3,"options","model","onInit","keydown.control.s","keydown.meta.s",4,"ngIf"],["wrap","off","class","hb-plain-text-editor align-self-end h-100 w-100 mb-3 mt-3","autocomplete","off","autocorrect","off","autocapitalize","off","spellcheck","false",3,"ngModel","ngModelChange",4,"ngIf"],[1,"fas","fa-spinner","fa-pulse"],[1,"flex-grow-1","h-100","w-100","mb-3","mt-3",3,"options","model","onInit","keydown.control.s","keydown.meta.s"],["wrap","off","autocomplete","off","autocorrect","off","autocapitalize","off","spellcheck","false",1,"hb-plain-text-editor","align-self-end","h-100","w-100","mb-3","mt-3",3,"ngModel","ngModelChange"]],template:function(e,o){1&e&&(t.TgZ(0,"div",0)(1,"div",1)(2,"div",2)(3,"h3",3)(4,"span",4),t._uU(5,"Docker Container"),t.qZA(),t._uU(6," startup.sh"),t.qZA()(),t.TgZ(7,"div",5)(8,"button",6),t.NdJ("click",function(){return o.onSave()}),t._uU(9),t.ALo(10,"translate"),t.YNc(11,T,1,0,"i",7),t.qZA()()(),t.TgZ(12,"div",8)(13,"div",9)(14,"div",10),t._uU(15," This script will be executed each time the docker container starts. You can use this to install any extra packages your plugins may need such as ffmpeg or libpcap-dev. "),t.qZA()()(),t.YNc(16,M,1,2,"ngx-monaco-editor",11),t.YNc(17,$,2,1,"textarea",12),t.qZA()),2&e&&(t.xp6(8),t.Q6J("disabled",o.saveInProgress),t.xp6(1),t.hij(" ",t.lcZ(10,6,"form.button_save")," "),t.xp6(2),t.Q6J("ngIf",o.saveInProgress),t.xp6(3),t.Q6J("translate","platform.docker.startup_script.message_script_help"),t.xp6(2),t.Q6J("ngIf",!o.isMobile),t.xp6(1),t.Q6J("ngIf",o.isMobile))},dependencies:[u.O5,l.Fj,l.JJ,l.On,v.PG,c.Pi,c.X$]}),r})();var Z=s(45417),I=s(48703);function J(r,n){1&r&&t._UZ(0,"app-spinner")}function Y(r,n){1&r&&(t.TgZ(0,"p",8),t._uU(1," Please wait, this page will automatically redirect when the Homebridge is back online."),t.qZA()),2&r&&t.Q6J("translate","restart.message_please_wait_while_server_restarts")}function E(r,n){if(1&r&&(t.TgZ(0,"p",9),t._uU(1),t.qZA()),2&r){const e=t.oxw();t.xp6(1),t.Oqu(e.error)}}function A(r,n){1&r&&(t.TgZ(0,"div")(1,"p",8),t._uU(2," Server restart is taking a long time. You may need to bring up the Docker container manually."),t.qZA(),t.TgZ(3,"p",10),t.ALo(4,"translate"),t._uU(5,"Make sure you're running the Docker container with "),t.TgZ(6,"strong"),t._uU(7,"--restart=always"),t.qZA()()()),2&r&&(t.xp6(1),t.Q6J("translate","platform.docker.restart_container.message_server_taking_long_time_to_restart"),t.xp6(2),t.Q6J("innerHTML",t.lcZ(4,2,"platform.docker.restart_container.message_run_with_restart_always"),t.oJD))}let D=(()=>{class r{constructor(e,o,i,a,h,g){this.$api=e,this.$ws=o,this.$settings=i,this.$toastr=a,this.translate=h,this.$router=g,this.io=this.$ws.connectToNamespace("status"),this.resp={},this.timeout=!1,this.error=!1}ngOnInit(){this.io.connected.subscribe(()=>{this.io.socket.emit("monitor-server-status"),this.$settings.getAppSettings().catch()}),this.$api.put("/platform-tools/docker/restart-container",{}).subscribe(e=>{this.resp=e,this.checkIfServerUp()},e=>{const o=this.translate.instant("restart.toast_server_restart_error");this.error=o+".",this.$toastr.error(`${o}: ${e.message}`,this.translate.instant("toast.title_error"))})}checkIfServerUp(){this.checkDelay=setTimeout(()=>{this.io.socket.on("homebridge-status",e=>{("up"===e.status||"pending"===e.status)&&(this.$toastr.success(this.translate.instant("platform.docker.restart_container.toast_container_restarted"),this.translate.instant("toast.title_success")),this.$router.navigate(["/"]))})},1e4),this.checkTimeout=setTimeout(()=>{this.$toastr.warning(this.translate.instant("restart.toast_sever_restart_timeout"),this.translate.instant("toast.title_warning"),{timeOut:1e4}),this.timeout=!0},6e4)}ngOnDestroy(){this.io.end(),clearTimeout(this.checkDelay),clearTimeout(this.checkTimeout)}}return r.\u0275fac=function(e){return new(e||r)(t.Y36(m.s),t.Y36(Z.r),t.Y36(_.g),t.Y36(d._W),t.Y36(c.sK),t.Y36(p.F0))},r.\u0275cmp=t.Xpm({type:r,selectors:[["app-container-restart"]],decls:10,vars:5,consts:[[4,"ngIf"],[1,"row"],[1,"col-md-12","text-center"],[1,"primary-text"],[1,"fab","fa-docker"],[1,"primary-text",3,"translate"],["class","grey-text",3,"translate",4,"ngIf"],["class","grey-text",4,"ngIf"],[1,"grey-text",3,"translate"],[1,"grey-text"],[1,"primary-text",3,"innerHTML"]],template:function(e,o){1&e&&(t.YNc(0,J,1,0,"app-spinner",0),t.TgZ(1,"div",1)(2,"div",2)(3,"h1",3),t._UZ(4,"i",4),t.qZA(),t.TgZ(5,"h3",5),t._uU(6,"Restarting Docker Container"),t.qZA(),t.YNc(7,Y,2,1,"p",6),t.YNc(8,E,2,1,"p",7),t.YNc(9,A,8,4,"div",0),t.qZA()()),2&e&&(t.Q6J("ngIf",!o.error),t.xp6(5),t.Q6J("translate","platform.docker.restart_container.title_restarting"),t.xp6(2),t.Q6J("ngIf",!o.timeout&&!o.error),t.xp6(1),t.Q6J("ngIf",o.error),t.xp6(1),t.Q6J("ngIf",o.timeout))},dependencies:[u.O5,c.Pi,I.O,c.X$],encapsulation:2}),r})(),w=(()=>{class r{constructor(e,o,i){this.$api=e,this.$toastr=o,this.$router=i}resolve(e,o){return this.$api.get("/platform-tools/docker/startup-script").toPromise().catch(i=>{this.$toastr.error(i.message,"Failed to Load Startup Script"),this.$router.navigate(["/"])})}}return r.\u0275fac=function(e){return new(e||r)(t.LFG(m.s),t.LFG(d._W),t.LFG(p.F0))},r.\u0275prov=t.Yz7({token:r,factory:r.\u0275fac}),r})();const P=[{path:"",redirectTo:"/",pathMatch:"full"},{path:"startup-script",component:b,resolve:{startupScript:w}},{path:"restart-container",component:D}];let U=(()=>{class r{}return r.\u0275fac=function(e){return new(e||r)},r.\u0275mod=t.oAB({type:r}),r.\u0275inj=t.cJS({imports:[p.Bz.forChild(P),p.Bz]}),r})(),V=(()=>{class r{}return r.\u0275fac=function(e){return new(e||r)},r.\u0275mod=t.oAB({type:r}),r.\u0275inj=t.cJS({providers:[w],imports:[u.ez,l.u5,l.UX,v.nm,x.IJ,c.aw.forChild(),S.I,U]}),r})()}}]);