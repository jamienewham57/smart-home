"use strict";(self.webpackChunkui=self.webpackChunkui||[]).push([[223],{82223:(O,c,s)=>{s.r(c),s.d(c,{LogsModule:()=>z});var g=s(36895),u=s(8304),d=s(57750),p=s(15861),v=s(77579),b=s(94327),m=s(81862),t=s(94650),$=s(92503),L=s(79274),y=s(76726),C=s(97185),M=s(54463);const x=["logoutput"];function F(o,a){if(1&o){const n=t.EpF();t.TgZ(0,"div",4)(1,"button",5),t.NdJ("click",function(){t.CHM(n);const i=t.oxw();return t.KtG(i.downloadLogFile())}),t._UZ(2,"i",6),t.qZA(),t.TgZ(3,"button",7),t.NdJ("click",function(){t.CHM(n);const i=t.oxw();return t.KtG(i.truncateLogFile())}),t._UZ(4,"i",8),t.qZA()()}}const T=[{path:"",component:(()=>{class o{constructor(n,e,i,l,r,f){this.$settings=n,this.$api=e,this.$log=i,this.$toastr=l,this.$translate=r,this.$modal=f,this.resizeEvent=new v.x}ngOnInit(){window.document.querySelector("body").classList.add("bg-black"),this.$log.startTerminal(this.termTarget,{},this.resizeEvent)}onWindowResize(n){this.resizeEvent.next(void 0)}ngOnDestroy(){window.document.querySelector("body").classList.remove("bg-black"),this.$log.destroyTerminal()}downloadLogFile(){var n=this;const e=this.$modal.open(m.X);e.componentInstance.title=this.$translate.instant("logs.title_download_log_file"),e.componentInstance.message=this.$translate.instant("logs.message_download_warning"),e.componentInstance.confirmButtonLabel=this.$translate.instant("logs.label_download"),e.result.then(()=>{this.$api.get("/platform-tools/hb-service/log/download",{observe:"response",responseType:"blob"}).subscribe(i=>{(0,b.saveAs)(i.body,"homebridge.log.txt")},function(){var i=(0,p.Z)(function*(l){let r;try{r=JSON.parse(yield l.error.text()).message}catch{}n.$toastr.error(r||"Failed to download log file",n.$translate.instant("toast.title_error"))});return function(l){return i.apply(this,arguments)}}())}).catch(()=>{})}truncateLogFile(){const n=this.$modal.open(m.X);n.componentInstance.title=this.$translate.instant("logs.title_truncate_log_file"),n.componentInstance.message=this.$translate.instant("logs.message_truncate_log_warning"),n.componentInstance.confirmButtonLabel=this.$translate.instant("logs.label_truncate"),n.result.then(()=>{this.$api.put("/platform-tools/hb-service/log/truncate",{}).subscribe(e=>{this.$toastr.success(this.$translate.instant("logs.message_log_file_truncated"),this.$translate.instant("toast.title_success")),this.$log.term.clear()},e=>{this.$toastr.error(e.error.message||"Failed to truncate log file",this.$translate.instant("toast.title_error"))})}).catch(()=>{})}}return o.\u0275fac=function(n){return new(n||o)(t.Y36($.g),t.Y36(L.s),t.Y36(y.$),t.Y36(C._W),t.Y36(M.sK),t.Y36(u.FF))},o.\u0275cmp=t.Xpm({type:o,selectors:[["app-logs"]],viewQuery:function(n,e){if(1&n&&t.Gf(x,7),2&n){let i;t.iGM(i=t.CRH())&&(e.termTarget=i.first)}},hostBindings:function(n,e){1&n&&t.NdJ("resize",function(l){return e.onWindowResize(l)},!1,t.Jf7)},decls:4,vars:1,consts:[["class","log-buttons",4,"ngIf"],[1,"flex-column","d-flex","align-items-stretch","h-100"],["id","log-output",1,"terminal","align-self-end","w-100","h-100","mb-1"],["logoutput",""],[1,"log-buttons"],[1,"btn","btn-primary",3,"click"],[1,"fas","fa-download"],[1,"btn","btn-danger",3,"click"],[1,"fas","fa-trash-alt"]],template:function(n,e){1&n&&(t.YNc(0,F,5,0,"div",0),t.TgZ(1,"div",1),t._UZ(2,"div",2,3),t.qZA()),2&n&&t.Q6J("ngIf",e.$settings.env.serviceMode)},dependencies:[g.O5],styles:[".log-buttons[_ngcontent-%COMP%]{position:fixed;top:80px;right:10px;z-index:1000}.log-buttons[_ngcontent-%COMP%]   button[_ngcontent-%COMP%]{opacity:.4;transition:opacity .2s ease-in}@media (hover: hover){.log-buttons[_ngcontent-%COMP%]   button[_ngcontent-%COMP%]:hover, .log-buttons[_ngcontent-%COMP%]   button[_ngcontent-%COMP%]:active{opacity:1}}"]}),o})()}];let w=(()=>{class o{}return o.\u0275fac=function(n){return new(n||o)},o.\u0275mod=t.oAB({type:o}),o.\u0275inj=t.cJS({imports:[d.Bz.forChild(T),d.Bz]}),o})(),z=(()=>{class o{}return o.\u0275fac=function(n){return new(n||o)},o.\u0275mod=t.oAB({type:o}),o.\u0275inj=t.cJS({imports:[g.ez,w,u.IJ]}),o})()}}]);