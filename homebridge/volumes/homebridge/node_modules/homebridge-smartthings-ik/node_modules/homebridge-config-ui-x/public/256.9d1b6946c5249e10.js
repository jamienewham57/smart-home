"use strict";(self.webpackChunkui=self.webpackChunkui||[]).push([[256],{84256:(Q,g,a)=>{a.r(g),a.d(g,{SetupWizardModule:()=>$});var p=a(36895),s=a(24006),l=a(54463),f=a(8304),_=a(40294),d=a(57750),c=a(15861),h=a(92340),b=a(69669),t=a(94650),v=a(97185),x=a(11481),w=a(79274),C=a(88951),y=a(92503);function Z(o,i){if(1&o){const e=t.EpF();t.TgZ(0,"div",3),t._UZ(1,"img",4)(2,"h3",5),t.TgZ(3,"button",6),t.NdJ("click",function(){t.CHM(e);const n=t.oxw();return t.KtG(n.onClickGettingStarted())}),t.qZA(),t.TgZ(4,"small",7)(5,"a",8),t.NdJ("click",function(){t.CHM(e);const n=t.oxw();return t.KtG(n.onClickRestoreBackup())}),t._uU(6,"Restore From Backup"),t.qZA()()()}}const u=function(o,i){return{"is-valid":o,"is-invalid":i}},z=function(o){return{"button-loading":o}};function U(o,i){if(1&o){const e=t.EpF();t.TgZ(0,"div",3),t._UZ(1,"img",9)(2,"h3",10),t.TgZ(3,"div",11),t._UZ(4,"p",12),t.TgZ(5,"form",13),t.NdJ("ngSubmit",function(){t.CHM(e);const n=t.oxw();return t.KtG(n.createFirstUser())}),t.TgZ(6,"div",14),t._UZ(7,"i",15)(8,"input",16),t.TgZ(9,"label",17),t._uU(10,"Username"),t.qZA()(),t.TgZ(11,"div",14),t._UZ(12,"i",18)(13,"input",19),t.TgZ(14,"label",20),t._uU(15,"Password"),t.qZA()(),t.TgZ(16,"div",14),t._UZ(17,"i",18)(18,"input",21)(19,"label",22),t.qZA(),t.TgZ(20,"div",23)(21,"button",24),t._uU(22),t.ALo(23,"translate"),t._UZ(24,"i",25),t.qZA()()()()()}if(2&o){const e=t.oxw();t.xp6(5),t.Q6J("formGroup",e.createUserForm),t.xp6(3),t.Q6J("readonly",e.loading)("ngClass",t.WLB(15,u,e.createUserForm.controls.username.dirty&&e.createUserForm.controls.username.valid,e.createUserForm.controls.username.dirty&&e.createUserForm.controls.username.invalid)),t.xp6(1),t.Q6J("translate","users.label_username"),t.xp6(4),t.Q6J("readonly",e.loading)("ngClass",t.WLB(18,u,e.createUserForm.controls.password.dirty&&e.createUserForm.controls.password.valid,e.createUserForm.controls.password.dirty&&e.createUserForm.controls.password.errors)),t.xp6(1),t.Q6J("translate","users.label_password"),t.xp6(4),t.Q6J("readonly",e.loading)("ngClass",t.WLB(21,u,e.createUserForm.controls.passwordConfirm.dirty&&e.createUserForm.controls.passwordConfirm.valid,e.createUserForm.controls.passwordConfirm.dirty&&e.createUserForm.controls.passwordConfirm.errors)),t.xp6(1),t.Q6J("translate","users.label_confirm_password"),t.xp6(2),t.Q6J("disabled",e.createUserForm.invalid||e.loading)("ngClass",t.VKq(24,z,e.loading)),t.xp6(1),t.hij(" ",t.lcZ(23,13,"setup_wizard.label_create_account")," ")}}function k(o,i){1&o&&(t.TgZ(0,"span"),t._UZ(1,"i",36),t._uU(2),t.ALo(3,"translate"),t.qZA()),2&o&&(t.xp6(2),t.hij(" ",t.lcZ(3,1,"backup.label_uploading")," "))}function T(o,i){1&o&&t._UZ(0,"span",27),2&o&&t.Q6J("translate","backup.button_restore_backup")}function F(o,i){if(1&o){const e=t.EpF();t.TgZ(0,"div",3),t._UZ(1,"img",9)(2,"h3",26)(3,"p",27),t.TgZ(4,"div",28)(5,"input",29),t.NdJ("change",function(n){t.CHM(e);const m=t.oxw();return t.KtG(m.handleRestoreFileInput(n.target.files))}),t.qZA(),t.TgZ(6,"label",30),t._uU(7),t.ALo(8,"translate"),t.qZA()(),t.TgZ(9,"div",31)(10,"button",32),t.NdJ("click",function(){t.CHM(e);const n=t.oxw();return t.KtG(n.onClickCancelRestore())}),t.qZA(),t.TgZ(11,"button",33),t.NdJ("click",function(){t.CHM(e);const n=t.oxw();return t.KtG(n.onRestoreBackupClick())}),t.YNc(12,k,4,3,"span",34),t.YNc(13,T,1,1,"span",35),t.qZA()()()}if(2&o){const e=t.oxw();t.xp6(3),t.Q6J("translate","backup.message_restore_help_one"),t.xp6(4),t.Oqu(t.lcZ(8,6,(null==e.selectedFile?null:e.selectedFile.name)||"backup.label_choose_backup_file_to_restore")),t.xp6(3),t.Q6J("disabled",e.restoreUploadStarted),t.xp6(1),t.Q6J("disabled",e.restoreUploading||!e.selectedFile),t.xp6(1),t.Q6J("ngIf",e.restoreUploading),t.xp6(1),t.Q6J("ngIf",!e.restoreUploading)}}function S(o,i){1&o&&(t.TgZ(0,"div",3),t._UZ(1,"img",9)(2,"h3",37),t.TgZ(3,"h1"),t._UZ(4,"i",36),t.qZA()())}function J(o,i){1&o&&(t.TgZ(0,"div",3),t._UZ(1,"img",9)(2,"h3",38)(3,"p",39)(4,"a",40),t.qZA())}const M=[{path:"",component:(()=>{class o{constructor(e,r,n,m,P,N,A,O){this.$router=e,this.$modal=r,this.$translate=n,this.$toastr=m,this.$title=P,this.$api=N,this.$auth=A,this.$settings=O,this.step="welcome",this.createUserForm=new s.cw({username:new s.NI("",[s.kI.required]),password:new s.NI("",[s.kI.compose([s.kI.required,s.kI.minLength(4)])]),passwordConfirm:new s.NI("",[s.kI.required])},this.matchPassword),this.loading=!1,this.restoreUploading=!1}ngOnInit(){this.previousTitle=this.$title.getTitle(),this.$title.setTitle("Setup Homebridge"),window.document.querySelector("body").classList.remove("body-top-padding")}matchPassword(e){if(e.get("password").value===e.get("passwordConfirm").value)return null;e.get("passwordConfirm").setErrors({matchPassword:!0})}ngOnDestroy(){this.$title.setTitle(this.previousTitle),window.document.querySelector("body").classList.add("body-top-padding")}onClickGettingStarted(){this.step="create-account"}onClickRestoreBackup(){this.step="restore-backup"}onClickCancelRestore(){this.selectedFile=null,this.step="welcome"}createFirstUser(){var e=this;this.loading=!0;const r=this.createUserForm.getRawValue();r.name=r.username,this.$api.post("/setup-wizard/create-first-user",r).subscribe((0,c.Z)(function*(){e.$settings.env.setupWizardComplete=!0,yield e.$auth.login({username:r.username,password:r.password}),e.step="setup-complete"}),n=>{this.loading=!1,this.$toastr.error(n.error.message||this.$translate.instant("users.toast_failed_to_add_user"),this.$translate.instant("toast.title_error"))})}handleRestoreFileInput(e){e.length?this.selectedFile=e[0]:delete this.selectedFile}onRestoreBackupClick(){this.restoreUploading=!0,this.uploadHomebridgeArchive()}uploadHomebridgeArchive(){var e=this;return(0,c.Z)(function*(){try{const r=yield e.$api.get("/setup-wizard/get-setup-wizard-token").toPromise();window.localStorage.setItem(h.N.jwt.tokenKey,r.access_token),e.$auth.token=r.access_token;const n=new FormData;n.append("restoreArchive",e.selectedFile,e.selectedFile.name),yield e.$api.post("/backup/restore",n).toPromise(),e.openRestoreModal(),e.restoreUploading=!1}catch(r){e.restoreUploading=!1,e.$toastr.error(r.error.message||e.$translate.instant("users.toast_failed_to_add_user"),e.$translate.instant("toast.title_error"))}})()}openRestoreModal(){const e=this.$modal.open(b.q,{size:"lg",backdrop:"static"});e.componentInstance.setupWizardRestore=!0,e.result.then(r=>{!0===r&&this.waitForHomebridgeToRestart()})}waitForHomebridgeToRestart(){var e=this;return(0,c.Z)(function*(){e.step="restarting",window.localStorage.removeItem(h.N.jwt.tokenKey),e.$auth.token=null,yield new Promise(n=>setTimeout(n,15e3));const r=setInterval((0,c.Z)(function*(){try{yield e.$api.get("/auth/settings").toPromise(),clearInterval(r),location.reload()}catch{}}),1e3)})()}}return o.\u0275fac=function(e){return new(e||o)(t.Y36(d.F0),t.Y36(f.FF),t.Y36(l.sK),t.Y36(v._W),t.Y36(x.Dx),t.Y36(w.s),t.Y36(C.e),t.Y36(y.g))},o.\u0275cmp=t.Xpm({type:o,selectors:[["app-setup-wizard"]],decls:7,vars:5,consts:[[1,"setup-container","d-flex","align-items-center","justify-content-center"],[1,"w-100","setup-card","d-flex","pb-5","pt-5"],["class","w-100 d-flex flex-column align-items-center",4,"ngIf"],[1,"w-100","d-flex","flex-column","align-items-center"],["src","/assets/homebridge-color-round.svg",1,"homebridge-logo","mr-auto","ml-auto"],["translate","setup_wizard.message_welcome_to_homebridge",1,"pt-4","pb-3","text-center"],["type","button","translate","setup_wizard.button_get_started",1,"btn","btn-lg","btn-primary",3,"click"],[1,"mt-3"],["href","javascript:void(0)",1,"grey-text",3,"click"],["src","/assets/homebridge-color-round.svg",1,"homebridge-logo","homebridge-logo-small","mr-auto","ml-auto"],["translate","setup_wizard.label_create_account",1,"pt-4","pb-3","text-center"],[1,"w-100"],["translate","setup_wizard.message_create_account_reason"],["novalidate","",3,"formGroup","ngSubmit"],[1,"md-form"],[1,"fas","fa-user","prefix","grey-text"],["formControlName","username","type","text","id","form-username","autocomplete","username","autocapitalize","none","tabindex","1",1,"form-control","pl-0","pr-0",3,"readonly","ngClass"],["for","form-username",3,"translate"],[1,"fas","fa-lock","prefix","grey-text"],["formControlName","password","type","password","id","form-pass","autocomplete","new-password","tabindex","2",1,"form-control","pl-0","pr-0",3,"readonly","ngClass"],["for","form-pass",3,"translate"],["formControlName","passwordConfirm","type","password","id","form-pass-confirm","autocomplete","new-password","tabindex","2",1,"form-control","pl-0","pr-0",3,"readonly","ngClass"],["for","form-pass-confirm",3,"translate"],[1,"w-100","text-center"],["type","submit",1,"btn","btn-primary",3,"disabled","ngClass"],[1,"button-loading-overlay","fas","fa-spinner","fa-pulse"],["translate","backup.title_restore",1,"pt-4","pb-3","text-center"],[3,"translate"],[1,"custom-file"],["type","file","id","restoreFileUpload","accept","application/gzip, .gz",1,"custom-file-input",3,"change"],["for","restoreFileUpload",1,"custom-file-label"],[1,"mt-3","w-100","d-flex","justify-content-between"],["type","button","translate","form.button_cancel",1,"btn","btn-elegant","ml-0",3,"disabled","click"],["type","button",1,"btn","btn-primary","mr-0",3,"disabled","click"],[4,"ngIf"],[3,"translate",4,"ngIf"],[1,"fas","fa-spinner","fa-pulse"],["translate","restart.title_restart",1,"pt-4","pb-3","text-center"],["translate","setup_wizard_message_complete_title",1,"pt-4","pb-3"],["translate","setup_wizard_message_complete_message",1,"text-center"],["routerLink","/","translate","setup_wizard.label_open_dashboard",1,"btn","btn-lg","btn-primary","mt-3"]],template:function(e,r){1&e&&(t.TgZ(0,"div",0)(1,"div",1),t.YNc(2,Z,7,0,"div",2),t.YNc(3,U,25,26,"div",2),t.YNc(4,F,14,8,"div",2),t.YNc(5,S,5,0,"div",2),t.YNc(6,J,5,0,"div",2),t.qZA()()),2&e&&(t.xp6(2),t.Q6J("ngIf","welcome"===r.step),t.xp6(1),t.Q6J("ngIf","create-account"===r.step),t.xp6(1),t.Q6J("ngIf","restore-backup"===r.step),t.xp6(1),t.Q6J("ngIf","restarting"===r.step),t.xp6(1),t.Q6J("ngIf","setup-complete"===r.step))},dependencies:[p.mk,p.O5,s._Y,s.Fj,s.JJ,s.JL,s.sg,s.u,l.Pi,d.yS,l.X$],styles:[".setup-container[_ngcontent-%COMP%]{background-size:cover;z-index:-1;padding-top:1em;padding-bottom:1em}@media screen and (min-height: 500px) and (min-width: 600px){.setup-container[_ngcontent-%COMP%]{padding-top:4em}}.setup-card[_ngcontent-%COMP%]{max-width:600px;border-radius:15px;background-color:#fff;padding-right:25px;padding-left:25px}.setup-card[_ngcontent-%COMP%]   .form-control[_ngcontent-%COMP%]:focus{background-color:inherit!important}@media screen and (max-width: 600px){.setup-card[_ngcontent-%COMP%]{margin-left:1em;margin-right:1em}}  body.dark-mode .setup-card{background-color:#2b2b2b;color:#fff}.homebridge-logo[_ngcontent-%COMP%]{margin-right:10px;height:200px}@media screen and (max-height: 500px){.homebridge-logo[_ngcontent-%COMP%]{height:100px}}@media screen and (max-width: 600px){.homebridge-logo[_ngcontent-%COMP%]{height:100px}}.homebridge-logo-small[_ngcontent-%COMP%]{height:50px}.button-loading[_ngcontent-%COMP%]{position:relative;color:#0000}.button-loading[_ngcontent-%COMP%]   .button-loading-overlay[_ngcontent-%COMP%]{display:block;color:#fff}.button-loading-overlay[_ngcontent-%COMP%]{display:none;position:absolute;top:9px;left:0;right:0}small[_ngcontent-%COMP%]   a[_ngcontent-%COMP%]:hover{text-decoration:underline}"]}),o})()}];let W=(()=>{class o{}return o.\u0275fac=function(e){return new(e||o)},o.\u0275mod=t.oAB({type:o}),o.\u0275inj=t.cJS({imports:[d.Bz.forChild(M),d.Bz]}),o})();var I=a(7289);let $=(()=>{class o{}return o.\u0275fac=function(e){return new(e||o)},o.\u0275mod=t.oAB({type:o}),o.\u0275inj=t.cJS({providers:[I.m],imports:[p.ez,s.u5,s.UX,l.aw,f.IJ,_.I,W]}),o})()}}]);